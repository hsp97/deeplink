let itemCounter=1;const listNameInput=document.getElementById("listName"),menuList=document.querySelector(".menu-sub"),mainContent=document.querySelector(".content");let saveTimer=null;const codeTemplates={button:'<button class="btn">í´ë¦­í•˜ì„¸ìš”</button>\n\n<style>\n.btn {\n    background: #1db954;\n    color: white;\n    border: none;\n    padding: 10px 20px;\n    border-radius: 5px;\n    cursor: pointer;\n    font-size: 16px;\n}\n.btn:hover {\n    background: #1ed760;\n}\n</style>',card:'<div class="card">\n    <div class="card-header">ì œëª©</div>\n    <div class="card-body">\n        <p>ì¹´ë“œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.</p>\n    </div>\n</div>\n\n<style>\n.card {\n    width: 300px;\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n}\n.card-header {\n    background: #f5f5f5;\n    padding: 15px;\n    font-weight: bold;\n    border-bottom: 1px solid #ddd;\n}\n.card-body {\n    padding: 15px;\n}\n</style>',form:'<form class="form">\n    <div class="form-group">\n        <label>ì´ë¦„</label>\n        <input type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">\n    </div>\n    <div class="form-group">\n        <label>ì´ë©”ì¼</label>\n        <input type="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">\n    </div>\n    <button type="submit">ì œì¶œ</button>\n</form>\n\n<style>\n.form {\n    max-width: 300px;\n    padding: 20px;\n}\n.form-group {\n    margin-bottom: 15px;\n}\n.form-group label {\n    display: block;\n    margin-bottom: 5px;\n    font-weight: bold;\n}\n.form-group input {\n    width: 100%;\n    padding: 8px;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    box-sizing: border-box;\n}\n.form button {\n    background: #1db954;\n    color: white;\n    border: none;\n    padding: 10px 20px;\n    border-radius: 4px;\n    cursor: pointer;\n}\n</style>',table:'<table class="table">\n    <thead>\n        <tr>\n            <th>ì´ë¦„</th>\n            <th>ë‚˜ì´</th>\n            <th>ì§ì—…</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td>í™ê¸¸ë™</td>\n            <td>25</td>\n            <td>ê°œë°œì</td>\n        </tr>\n        <tr>\n            <td>ê¹€ì² ìˆ˜</td>\n            <td>30</td>\n            <td>ë””ìì´ë„ˆ</td>\n        </tr>\n    </tbody>\n</table>\n\n<style>\n.table {\n    width: 100%;\n    border-collapse: collapse;\n}\n.table th, .table td {\n    border: 1px solid #ddd;\n    padding: 10px;\n    text-align: left;\n}\n.table th {\n    background: #f5f5f5;\n}\n.table tr:hover {\n    background: #f9f9f9;\n}\n</style>',flexbox:'<div class="flex-container">\n    <div class="flex-item">1</div>\n    <div class="flex-item">2</div>\n    <div class="flex-item">3</div>\n</div>\n\n<style>\n.flex-container {\n    display: flex;\n    gap: 10px;\n    padding: 10px;\n    background: #f0f0f0;\n}\n.flex-item {\n    flex: 1;\n    padding: 20px;\n    background: #1db954;\n    color: white;\n    text-align: center;\n    border-radius: 4px;\n}\n</style>'};function initSectorSplitter(e){const t=e.querySelector(".splitter-horizontal"),n=e.querySelector(".splitter-vertical"),o=e.querySelector(".left-container"),a=e.querySelector(".memo-area"),r=e.querySelector(".description-area"),i=e.querySelector(".right-container"),s=e.querySelector(".result-iframe"),l=e.querySelector(".splitter-console"),c=e.querySelector(".result-area"),d=e.querySelector(".console-area");let u=!1,m=null,p=0,v=0,g=1,b=1,f=1,h=1,y=1,x=1,S=null,C=null;a.style.flex="2 0 0",r.style.flex="1 0 0",o.style.flex="1 0 0",i.style.flex="1 0 0",c.style.flex="4 0 0",d.style.flex="1 0 0",t.addEventListener("mousedown",e=>{u=!0,m="horizontal",t.classList.add("active"),s.classList.add("dragging"),S=e.clientX,C=e.clientY,p=e.clientY;const n=a.getBoundingClientRect().height,o=r.getBoundingClientRect().height,i=n+o;g=n/i,b=o/i,e.preventDefault()}),n.addEventListener("mousedown",e=>{u=!0,m="vertical",n.classList.add("active"),s.classList.add("dragging"),S=e.clientX,C=e.clientY,v=e.clientX;const t=o.getBoundingClientRect().width,a=i.getBoundingClientRect().width,r=t+a;h=t/r,y=a/r,e.preventDefault()}),l.addEventListener("mousedown",e=>{u=!0,m="horizontalConsole",l.classList.add("active"),s.classList.add("dragging"),S=e.clientX,C=e.clientY,p=e.clientY;const t=c.getBoundingClientRect().height,n=d.getBoundingClientRect().height,o=t+n;f=t/o,x=n/o,e.preventDefault()}),document.addEventListener("mousemove",e=>{u&&(S=e.clientX,C=e.clientY)}),document.addEventListener("mouseup",()=>{u&&(u=!1,t.classList.remove("active"),n.classList.remove("active"),l.classList.remove("active"),s.classList.remove("dragging"),m=null)}),requestAnimationFrame(function t(){if(u&&(null!==S||null!==C))if("horizontal"===m){const e=o.getBoundingClientRect().height-4,t=(e*g+(C-p))/e,n=1-t;t>.1&&t<.9&&(a.style.flex=`${t} 0 0`,r.style.flex=`${n} 0 0`)}else if("vertical"===m){const t=e.querySelector(".sector-grid-container").getBoundingClientRect().width-4,n=(t*h+(S-v))/t,a=1-n;n>.2&&n<.8&&(o.style.flex=`${n} 0 0`,i.style.flex=`${a} 0 0`)}else if("horizontalConsole"===m){const e=i.getBoundingClientRect().height-4,t=(e*f+(C-p))/e,n=1-t;t>.1&&t<.9&&(c.style.flex=`${t} 0 0`,d.style.flex=`${n} 0 0`)}requestAnimationFrame(t)})}function initSplitters(){document.querySelectorAll(".content-sector").forEach(e=>{initSectorSplitter(e)})}function toggleSidebar(){document.querySelector(".sidebar").classList.toggle("collapsed")}document.addEventListener("DOMContentLoaded",()=>{loadStateFromUrl(),window.addEventListener("message",e=>{if(e.data&&"console"===e.data.type){const t=document.querySelector(".content-sector.active");if(t){const n=t.querySelector(".console-output");if(n){const t=document.createElement("div");t.className=`console-log ${e.data.logType}`,t.textContent=e.data.message,n.appendChild(t),n.scrollTop=n.scrollHeight}}}}),mainContent.addEventListener("click",e=>{if(e.target.classList.contains("template-btn")){const t=e.target.dataset.template,n=codeTemplates[t];if(n){const t=e.target.closest(".content-sector");if(t&&t.aceEditorInstance){const e=t.aceEditorInstance;e.insert(n),e.focus(),saveStateToUrl(),renderCode(t)}}}}),mainContent.addEventListener("input",e=>{if("TEXTAREA"===e.target.tagName){const t=e.target.closest(".content-sector");clearTimeout(saveTimer),saveTimer=setTimeout(()=>{saveStateToUrl(),renderCode(t)},500)}}),initSplitters(),document.querySelectorAll(".content-sector").forEach(renderCode)});const btn={add:function(){const e=listNameInput.value.trim(),t="sector-"+itemCounter,n="menu-"+itemCounter;if(""==e)return void alert("ë¦¬ìŠ¤íŠ¸ ì¶”ê°€ í•„ìš”");if(Array.from(document.querySelectorAll(".menu-sub .menu-item div")).map(e=>e.textContent.trim()).includes(e))return void alert(`"${e}" ì´ë¦„ì€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤!`);const o=document.createElement("li");o.className="menu-item";const a=document.createElement("button");a.className="btn btn-primary btn-delete",a.textContent="-",a.addEventListener("click",e=>{e.stopPropagation(),btn.delete(t)});const r=document.createElement("a");r.href="#",r.className="menu-link",r.setAttribute("data-tooltip",e),r.id=n,r.addEventListener("click",e=>{e.preventDefault(),this.changeSector(t,r)}),r.innerHTML=`\n                <span class="menu-icon">ğŸ“</span>\n                <div>${e}</div>\n            `,o.appendChild(a),o.appendChild(r),menuList.appendChild(o);const i=document.createElement("div");i.className="content-sector",i.id=t;const s="editor-"+itemCounter;i.innerHTML=`\n                <div class="sector-grid-container">\n                    <div class="left-container">\n                        <div class="template-bar">\n                            <button class="template-btn" data-template="button">ë²„íŠ¼</button>\n                            <button class="template-btn" data-template="card">ì¹´ë“œ</button>\n                            <button class="template-btn" data-template="form">í¼</button>\n                            <button class="template-btn" data-template="table">í…Œì´ë¸”</button>\n                            <button class="template-btn" data-template="flexbox">Flexbox</button>\n                        </div>\n                        <div class="memo-area">\n                            <div id="${s}" class="ace-editor-input"></div>\n                        </div>\n                        <div class="splitter splitter-horizontal"></div>\n                        <div class="description-area">\n                            <textarea class="description-input" placeholder="ì„¤ëª… ì…ë ¥ êµ¬ì—­"></textarea>\n                        </div>\n                    </div>\n                    <div class="splitter splitter-vertical"></div>                   \n                    <div class="right-container">\n                        <div class="result-area">\n                            <iframe class="result-iframe" sandbox="allow-scripts allow-modals"></iframe>\n                        </div>\n                        <div class="splitter splitter-console"></div>\n                        <div class="console-area">\n                            <div class="console-header">\n                                <span>ì½˜ì†”</span>\n                                <button class="console-clear-btn" onclick="clearConsole(this)">ì§€ìš°ê¸°</button>\n                            </div>\n                            <div class="console-output"></div>\n                        </div>\n                    </div>\n                </div>\n            `,mainContent.appendChild(i),initSectorSplitter(i),initAceEditor(i,""),this.changeSector(t,r),listNameInput.value="",itemCounter++,saveStateToUrl()},delete:function(e){const t=document.getElementById(e),n=e.replace("sector-","menu-"),o=document.getElementById(n);if(!t||!o)return;const a=o.querySelector("div").textContent;if(!confirm(`"${a}" ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return;const r=t.classList.contains("active");if(t.remove(),o.closest(".menu-item").remove(),r){const e=document.querySelectorAll(".content-sector");if(e.length>0){const t=e[0],n=t.id.replace("sector-","menu-"),o=document.getElementById(n);this.changeSector(t.id,o)}}saveStateToUrl()},changeSector:function(e,t){document.querySelectorAll(".menu-link").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".content-sector").forEach(e=>{e.classList.remove("active")}),t&&t.classList.add("active");const n=document.getElementById(e);n&&n.classList.add("active"),saveStateToUrl()}};function saveStateToUrl(){const e=[];document.querySelectorAll(".content-sector").forEach((t,n)=>{const o=document.querySelectorAll(".menu-sub .menu-item")[n].querySelector("div").textContent,a=t.aceEditorInstance,r=a?a.getValue():t.querySelector(".ace-editor-input")?.textContent||"",i=t.querySelector(".description-input")?.value||"";e.push({id:t.id,name:o,memo:r,description:i})});const t=document.querySelector(".menu-link.active"),n=t?t.id:null,o=document.querySelector(".content-sector.active"),a=o?o.id:null,r={sectors:e,activeMenuId:n,activeSectorId:a};try{const e=JSON.stringify(r),t=encodeURIComponent(e),n=btoa(t);window.location.hash=n}catch(e){console.error("ìƒíƒœ ì €ì¥ ì‹¤íŒ¨:",e)}}function loadStateFromUrl(){const e=window.location.hash.substring(1);if(e)try{const t=atob(e),n=JSON.parse(decodeURIComponent(t));if(!n.sectors)return;const o=document.querySelector(".menu-sub"),a=document.querySelector(".content");if(o.innerHTML="",a.innerHTML="",n.sectors.forEach(e=>{const t=document.createElement("li");t.className="menu-item";const n=document.createElement("button");n.className="btn btn-primary btn-delete",n.textContent="-",n.addEventListener("click",t=>{t.stopPropagation(),btn.delete(e.id)});const r=document.createElement("a");r.href="#",r.className="menu-link",r.setAttribute("data-tooltip",e.name),r.id=e.id.replace("sector-","menu-"),r.addEventListener("click",t=>{t.preventDefault(),btn.changeSector(e.id,r)}),r.innerHTML=`<span class="menu-icon">ğŸ“</span><div>${e.name}</div>`,t.appendChild(n),t.appendChild(r),o.appendChild(t);const i=document.createElement("div");i.className="content-sector",i.id=e.id;const s=e.id.replace("sector-","editor-");i.innerHTML=`\n                    <div class="sector-grid-container">\n                        <div class="left-container">\n                            <div class="template-bar">\n                                <button class="template-btn" data-template="button">ë²„íŠ¼</button>\n                                <button class="template-btn" data-template="card">ì¹´ë“œ</button>\n                                <button class="template-btn" data-template="form">í¼</button>\n                                <button class="template-btn" data-template="table">í…Œì´ë¸”</button>\n                                <button class="template-btn" data-template="flexbox">Flexbox</button>\n                            </div>\n                            <div class="memo-area">\n                                <div id="${s}" class="ace-editor-input">${e.memo||""}</div>\n                            </div>\n                            <div class="splitter splitter-horizontal"></div>\n                            <div class="description-area">\n                                <textarea class="description-input" placeholder="ì„¤ëª… ì…ë ¥ êµ¬ì—­">${e.description||""}</textarea>\n                            </div>\n                        </div>\n                        <div class="splitter splitter-vertical"></div>\n                        <div class="right-container">\n                            <div class="result-area">\n                                <iframe class="result-iframe" sandbox="allow-scripts allow-modals"></iframe>\n                            </div>\n                            <div class="splitter splitter-console"></div>\n                            <div class="console-area">\n                                <div class="console-header">\n                                    <span>ì½˜ì†”</span>\n                                    <button class="console-clear-btn" onclick="clearConsole(this)">ì§€ìš°ê¸°</button>\n                                </div>\n                                <div class="console-output"></div>\n                            </div>\n                        </div>\n                    </div>\n                `,a.appendChild(i),initSectorSplitter(i),initAceEditor(i,e.memo||"")}),n.activeSectorId){const e=n.activeMenuId?document.getElementById(n.activeMenuId):null;btn.changeSector(n.activeSectorId,e)}if(n.sectors.length>0){const e=Math.max(...n.sectors.map(e=>{const t=parseInt(e.id.replace("sector-",""));return isNaN(t)?0:t}));itemCounter=e+1}else itemCounter=1}catch(e){console.error("ìƒíƒœ ë³µì› ì‹¤íŒ¨:",e)}else itemCounter=1}function renderCode(e){const t=e.aceEditorInstance,n=e.querySelector(".result-iframe"),o=e.querySelector(".console-output");if(!t||!n)return;o&&(o.innerHTML="");const a=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <meta charset="UTF-8">\n                \n        <script>\n            (function() {\n                const originalConsole = {\n                    log: console.log,\n                    error: console.error,\n                    warn: console.warn,\n                    info: console.info\n                };\n                \n                function sendToParent(type, args) {\n                    const message = Array.from(args).map(arg => {\n                        if (typeof arg === 'object') {\n                            try {\n                                return JSON.stringify(arg, null, 2);\n                            } catch (e) {\n                                return String(arg);\n                            }\n                        }\n                        return String(arg);\n                    }).join(' ');\n                    \n                    parent.postMessage({\n                        type: 'console',\n                        logType: type,\n                        message: message\n                    }, '*');\n                }\n                \n                console.log = function() {\n                    sendToParent('log', arguments);\n                    originalConsole.log.apply(console, arguments);\n                };\n                \n                console.error = function() {\n                    sendToParent('error', arguments);\n                    originalConsole.error.apply(console, arguments);\n                };\n                \n                console.warn = function() {\n                    sendToParent('warn', arguments);\n                    originalConsole.warn.apply(console, arguments);\n                };\n                \n                console.info = function() {\n                    sendToParent('info', arguments);\n                    originalConsole.info.apply(console, arguments);\n                };\n                \n                // ì—ëŸ¬ ìºì¹˜\n                window.onerror = function(msg, url, line, col, error) {\n                    sendToParent('error', ['Error: ' + msg + ' (line ' + line + ')']);\n                    return false;\n                };\n            })();\n        <\/script>\n    \n                <style>\n                    /* ê¸°ë³¸ margin ì œê±° ë° iframe í¬ê¸° ì¡°ì •ì— ìœ ì—°í•˜ë„ë¡ ì„¤ì • */\n                    body { margin: 0; padding: 0; font-family: sans-serif; }\n                </style>\n            </head>\n            <body>\n                ${t.getValue()}\n            </body>\n            </html>\n        `;n.srcdoc=a}function initAceEditor(e,t){const n=e.querySelector(".ace-editor-input").id,o=ace.edit(n);o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),o.setTheme("ace/theme/monokai"),o.session.setMode("ace/mode/html"),o.setValue(t||"",-1),o.session.on("change",()=>{clearTimeout(saveTimer),saveTimer=setTimeout(()=>{e.aceEditorInstance=o,saveStateToUrl(),renderCode(e)},500)}),e.aceEditorInstance=o}function clearConsole(e){const t=e.closest(".console-area").querySelector(".console-output");t&&(t.innerHTML="")}