let itemCounter=1;const listNameInput=document.getElementById("listName");const menuList=document.querySelector(".menu-sub");const mainContent=document.querySelector(".content");let saveTimer=null;let liveMode=true;const codeTemplates={button:`<button class="btn">í´ë¦­í•˜ì„¸ìš”</button>\n\n<style>\n.btn {\n    background: #1db954;\n    color: white;\n    border: none;\n    padding: 10px 20px;\n    border-radius: 5px;\n    cursor: pointer;\n    font-size: 16px;\n}\n.btn:hover {\n    background: #1ed760;\n}\n</style>`,card:`<div class="card">\n    <div class="card-header">ì œëª©</div>\n    <div class="card-body">\n        <p>ì¹´ë“œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.</p>\n    </div>\n</div>\n\n<style>\n.card {\n    width: 300px;\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n}\n.card-header {\n    background: #f5f5f5;\n    padding: 15px;\n    font-weight: bold;\n    border-bottom: 1px solid #ddd;\n}\n.card-body {\n    padding: 15px;\n}\n</style>`,form:`<form class="form">\n    <div class="form-group">\n        <label>ì´ë¦„</label>\n        <input type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">\n    </div>\n    <div class="form-group">\n        <label>ì´ë©”ì¼</label>\n        <input type="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">\n    </div>\n    <button type="submit">ì œì¶œ</button>\n</form>\n\n<style>\n.form {\n    max-width: 300px;\n    padding: 20px;\n}\n.form-group {\n    margin-bottom: 15px;\n}\n.form-group label {\n    display: block;\n    margin-bottom: 5px;\n    font-weight: bold;\n}\n.form-group input {\n    width: 100%;\n    padding: 8px;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    box-sizing: border-box;\n}\n.form button {\n    background: #1db954;\n    color: white;\n    border: none;\n    padding: 10px 20px;\n    border-radius: 4px;\n    cursor: pointer;\n}\n</style>`,table:`<table class="table">\n    <thead>\n        <tr>\n            <th>ì´ë¦„</th>\n            <th>ë‚˜ì´</th>\n            <th>ì§ì—…</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td>í™ê¸¸ë™</td>\n            <td>25</td>\n            <td>ê°œë°œì</td>\n        </tr>\n        <tr>\n            <td>ê¹€ì² ìˆ˜</td>\n            <td>30</td>\n            <td>ë””ìì´ë„ˆ</td>\n        </tr>\n    </tbody>\n</table>\n\n<style>\n.table {\n    width: 100%;\n    border-collapse: collapse;\n}\n.table th, .table td {\n    border: 1px solid #ddd;\n    padding: 10px;\n    text-align: left;\n}\n.table th {\n    background: #f5f5f5;\n}\n.table tr:hover {\n    background: #f9f9f9;\n}\n</style>`,flexbox:`<div class="flex-container">\n    <div class="flex-item">1</div>\n    <div class="flex-item">2</div>\n    <div class="flex-item">3</div>\n</div>\n\n<style>\n.flex-container {\n    display: flex;\n    gap: 10px;\n    padding: 10px;\n    background: #f0f0f0;\n}\n.flex-item {\n    flex: 1;\n    padding: 20px;\n    background: #1db954;\n    color: white;\n    text-align: center;\n    border-radius: 4px;\n}\n</style>`,sample:`\n    <div class="container">\n  <h1>Hello World!</h1>\n  <p>Live Editorì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.</p>\n  <button id="myBtn">í´ë¦­í•˜ì„¸ìš”</button>\n  <p id="output"></p>\n</div>\n\n<style>\n.container {\n  font-family: Arial, sans-serif;\n  padding: 20px;\n  text-align: center;\n}\n\nh1 {\n  color: #333;\n}\n\nbutton {\n  background: #007bff;\n  color: white;\n  border: none;\n  padding: 10px 20px;\n  border-radius: 5px;\n  cursor: pointer;\n}\n\nbutton:hover {\n  background: #0056b3;\n}\n</style>\n<script>\nconst btn = document.getElementById('myBtn');\nconst output = document.getElementById('output');\nlet count = 0;\n\nbtn.addEventListener('click', () => {\n  count++;\n  output.textContent = count + 'ë²ˆ í´ë¦­í–ˆìŠµë‹ˆë‹¤!';\n  console.log('ë²„íŠ¼ í´ë¦­:', count);\n});\n\nconsole.log('JavaScriptê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');\n<\/script>\n    `};const libraryUrls={jquery:{js:["https://code.jquery.com/jquery-3.7.1.min.js"]},bootstrap:{css:["https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"],js:["https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"]},tailwind:{js:["https://cdn.tailwindcss.com"]},vue:{js:["https://unpkg.com/vue@3/dist/vue.global.js"]}};const clickHandlers={handleTabClick:function(event,sectorElement){const tab=event.target.closest(".editor-tab");if(!tab)return false;const tabType=tab.dataset.tab;sectorElement.querySelectorAll(".editor-tab").forEach(t=>t.classList.remove("active"));tab.classList.add("active");sectorElement.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));sectorElement.querySelector(`.${tabType}-content`).classList.add("active");const editor=sectorElement.aceEditorInstance;if(editor){const resultArea=sectorElement.querySelector(".result-area");const consoleArea=sectorElement.querySelector(".console-area");if(tabType==="backend"){const language=sectorElement.querySelector(".language-radio input:checked").value;updateEditorMode(editor,language);resultArea.style.flex=`1 0 0`;consoleArea.style.flex=`15 0 0`}else{updateEditorMode(editor,"html");resultArea.style.flex=`4 0 0`;consoleArea.style.flex=`1 0 0`}}return true},handleTemplateClick:function(event,sectorElement){if(!event.target.classList.contains("template-btn"))return false;const templateName=event.target.dataset.template;const template=codeTemplates[templateName];if(template&&sectorElement.aceEditorInstance){const editor=sectorElement.aceEditorInstance;editor.insert(template+"\n");editor.focus();saveStateToUrl();renderCode(sectorElement)}return true},handleFormatClick:function(event,sectorElement){if(!event.target.classList.contains("format-btn"))return false;formatCode(event.target);return true},handleRunClick:async function(event,sectorElement){if(!event.target.classList.contains("run-btn"))return false;const btn=event.target;const editor=sectorElement.aceEditorInstance;if(!editor)return true;const code=editor.getValue();if(!code.trim()){alert("ì‹¤í–‰í•  ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");return true}const languageInput=sectorElement.querySelector(".language-radio input:checked");const language=languageInput?languageInput.value:"python";const consoleOutput=sectorElement.querySelector(".console-output");btn.disabled=true;btn.textContent="ì‹¤í–‰ ì¤‘...";consoleOutput.innerHTML="";appendConsoleLog(consoleOutput,`[${language.toUpperCase()}] ì½”ë“œ ì‹¤í–‰ ì¤‘...`,"info");try{const result=await executeCode(language,code);if(result.run){if(result.run.stdout){appendConsoleLog(consoleOutput,result.run.stdout,"log")}if(result.run.stderr){appendConsoleLog(consoleOutput,result.run.stderr,"error")}if(!result.run.stdout&&!result.run.stderr){appendConsoleLog(consoleOutput,"(ì¶œë ¥ ì—†ìŒ)","info")}appendConsoleLog(consoleOutput,`[ì™„ë£Œ] ì‹¤í–‰ ì‹œê°„: ${result.run.time||0}ms`,"info")}if(result.message){appendConsoleLog(consoleOutput,`[ì—ëŸ¬] ${result.message}`,"error")}}catch(error){appendConsoleLog(consoleOutput,`[ì—ëŸ¬] API í˜¸ì¶œ ì‹¤íŒ¨: ${error.message}`,"error")}finally{btn.disabled=false;btn.textContent="â–¶ ì‹¤í–‰";consoleOutput.scrollTop=consoleOutput.scrollHeight}return true}};new Sortable(menuList,{animation:150,handle:".menu-link",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",onEnd:function(evt){const menuItems=document.querySelectorAll(".menu-sub .menu-item");const contentArea=document.querySelector(".content");menuItems.forEach(menuItem=>{const menuLink=menuItem.querySelector(".menu-link");const sectorId=menuLink.id.replace("menu-","sector-");const sector=document.getElementById(sectorId);if(sector){contentArea.appendChild(sector)}});saveStateToUrl()}});document.addEventListener("DOMContentLoaded",()=>{loadStateFromUrl();menuList.addEventListener("dblclick",event=>{const menuLink=event.target.closest(".menu-link");if(!menuLink)return;const nameDiv=menuLink.querySelector("div");if(!nameDiv)return;const currentName=nameDiv.textContent.trim();if(menuLink.querySelector(".edit-input"))return;const input=document.createElement("input");input.type="text";input.className="edit-input";input.value=currentName;nameDiv.style.display="none";menuLink.appendChild(input);input.focus();input.select();const saveName=()=>{const newName=input.value.trim();if(newName&&newName!==currentName){const existingNames=Array.from(document.querySelectorAll(".menu-sub .menu-item div")).map(div=>div.textContent.trim()).filter(name=>name!==currentName);if(existingNames.includes(newName)){alert(`"${newName}" ì´ë¦„ì€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤!`);nameDiv.style.display="";input.remove();return}nameDiv.textContent=newName;menuLink.setAttribute("data-tooltip",newName);saveStateToUrl()}nameDiv.style.display="";input.remove()};input.addEventListener("keydown",e=>{if(e.key==="Enter"){e.preventDefault();saveName()}if(e.key==="Escape"){nameDiv.style.display="";input.remove()}});const cancelEdit=()=>{nameDiv.style.display="";input.remove()};input.addEventListener("blur",cancelEdit)});window.addEventListener("message",event=>{if(event.data&&event.data.type==="console"){const activeSector=document.querySelector(".content-sector.active");if(activeSector){const consoleOutput=activeSector.querySelector(".console-output");if(consoleOutput){const logDiv=document.createElement("div");logDiv.className=`console-log ${event.data.logType}`;logDiv.textContent=event.data.message;consoleOutput.appendChild(logDiv);consoleOutput.scrollTop=consoleOutput.scrollHeight}}}});mainContent.addEventListener("click",async event=>{const sectorElement=event.target.closest(".content-sector");if(!sectorElement)return;if(clickHandlers.handleTabClick(event,sectorElement))return;if(clickHandlers.handleTemplateClick(event,sectorElement))return;if(clickHandlers.handleFormatClick(event,sectorElement))return;await clickHandlers.handleRunClick(event,sectorElement)});mainContent.addEventListener("change",event=>{const sectorElement=event.target.closest(".content-sector");if(event.target.matches('.language-radio input[type="radio"]')){const editor=sectorElement.aceEditorInstance;if(editor){updateEditorMode(editor,event.target.value)}}if(event.target.matches('.library-checkbox input[type="checkbox"]')){if(sectorElement){saveStateToUrl();renderCode(sectorElement)}}});mainContent.addEventListener("input",event=>{if(event.target.tagName==="TEXTAREA"){const sectorElement=event.target.closest(".content-sector");clearTimeout(saveTimer);saveTimer=setTimeout(()=>{saveStateToUrl();renderCode(sectorElement)},500)}});initSplitters();document.querySelectorAll(".content-sector").forEach(renderCode);document.addEventListener("keydown",e=>{const activeSector=document.querySelector(".content-sector.active");if(e.key==="Escape"){const fullscreenArea=document.querySelector(".result-area.fullscreen");if(fullscreenArea){const btn=fullscreenArea.querySelector(".fullscreen-btn");toggleFullscreen(btn)}}if(e.key==="F11"){e.preventDefault();if(activeSector){const btn=activeSector.querySelector(".fullscreen-btn");if(btn)toggleFullscreen(btn)}return}if(e.ctrlKey){if(e.key==="s"){return}if(e.key==="Enter"){return}if(e.key==="d"){e.preventDefault();downloadHTML();return}if(e.shiftKey&&e.key==="F"){e.preventDefault();if(activeSector){const formatBtn=activeSector.querySelector(".format-btn");if(formatBtn)formatCode(formatBtn)}return}}})});function initSectorSplitter(sectorElement){const horizontalSplitter=sectorElement.querySelector(".splitter-horizontal");const verticalSplitter=sectorElement.querySelector(".splitter-vertical");const leftContainer=sectorElement.querySelector(".left-container");const memoArea=sectorElement.querySelector(".memo-area");const descriptionArea=sectorElement.querySelector(".description-area");const rightContainer=sectorElement.querySelector(".right-container");const resultIframe=sectorElement.querySelector(".result-iframe");const horizontalConsoleSplitter=sectorElement.querySelector(".splitter-console");const resultArea=sectorElement.querySelector(".result-area");const consoleArea=sectorElement.querySelector(".console-area");let isResizing=false;let currentSplitter=null;let startY=0;let startX=0;let startMemoRatio=1;let startDescriptionRatio=1;let startResultRatio=1;let startLeftRatio=1;let startRightRatio=1;let startConsoleRatio=1;let latestMouseX=null;let latestMouseY=null;memoArea.style.flex="2 0 0";descriptionArea.style.flex="1 0 0";leftContainer.style.flex="1 0 0";rightContainer.style.flex="1 0 0";resultArea.style.flex="4 0 0";consoleArea.style.flex="1 0 0";horizontalSplitter.addEventListener("mousedown",e=>{isResizing=true;currentSplitter="horizontal";horizontalSplitter.classList.add("active");resultIframe.classList.add("dragging");latestMouseX=e.clientX;latestMouseY=e.clientY;startY=e.clientY;const memoHeight=memoArea.getBoundingClientRect().height;const descriptionHeight=descriptionArea.getBoundingClientRect().height;const totalHeight=memoHeight+descriptionHeight;startMemoRatio=memoHeight/totalHeight;startDescriptionRatio=descriptionHeight/totalHeight;e.preventDefault()});verticalSplitter.addEventListener("mousedown",e=>{isResizing=true;currentSplitter="vertical";verticalSplitter.classList.add("active");resultIframe.classList.add("dragging");latestMouseX=e.clientX;latestMouseY=e.clientY;startX=e.clientX;const leftWidth=leftContainer.getBoundingClientRect().width;const rightWidth=rightContainer.getBoundingClientRect().width;const totalWidth=leftWidth+rightWidth;startLeftRatio=leftWidth/totalWidth;startRightRatio=rightWidth/totalWidth;e.preventDefault()});horizontalConsoleSplitter.addEventListener("mousedown",e=>{isResizing=true;currentSplitter="horizontalConsole";horizontalConsoleSplitter.classList.add("active");resultIframe.classList.add("dragging");latestMouseX=e.clientX;latestMouseY=e.clientY;startY=e.clientY;const resultHeight=resultArea.getBoundingClientRect().height;const consoleHeight=consoleArea.getBoundingClientRect().height;const totalHeight=resultHeight+consoleHeight;startResultRatio=resultHeight/totalHeight;startConsoleRatio=consoleHeight/totalHeight;e.preventDefault()});document.addEventListener("mousemove",e=>{if(!isResizing)return;latestMouseX=e.clientX;latestMouseY=e.clientY});document.addEventListener("mouseup",()=>{if(isResizing){isResizing=false;horizontalSplitter.classList.remove("active");verticalSplitter.classList.remove("active");horizontalConsoleSplitter.classList.remove("active");resultIframe.classList.remove("dragging");currentSplitter=null}});function update(){if(isResizing&&(latestMouseX!==null||latestMouseY!==null)){if(currentSplitter==="horizontal"){const containerHeight=leftContainer.getBoundingClientRect().height-4;const deltaY=latestMouseY-startY;const currentMemoHeight=containerHeight*startMemoRatio;const newMemoHeight=currentMemoHeight+deltaY;const newMemoRatio=newMemoHeight/containerHeight;const newDescriptionRatio=1-newMemoRatio;if(newMemoRatio>.1&&newMemoRatio<.9){memoArea.style.flex=`${newMemoRatio} 0 0`;descriptionArea.style.flex=`${newDescriptionRatio} 0 0`}}else if(currentSplitter==="vertical"){const containerWidth=sectorElement.querySelector(".sector-grid-container").getBoundingClientRect().width-4;const deltaX=latestMouseX-startX;const currentLeftWidth=containerWidth*startLeftRatio;const newLeftWidth=currentLeftWidth+deltaX;const newLeftRatio=newLeftWidth/containerWidth;const newRightRatio=1-newLeftRatio;if(newLeftRatio>.2&&newLeftRatio<.8){leftContainer.style.flex=`${newLeftRatio} 0 0`;rightContainer.style.flex=`${newRightRatio} 0 0`}}else if(currentSplitter==="horizontalConsole"){const containerHeight=rightContainer.getBoundingClientRect().height-4;const deltaY=latestMouseY-startY;const currentResultHeight=containerHeight*startResultRatio;const newResultHeight=currentResultHeight+deltaY;const newResultRatio=newResultHeight/containerHeight;const newConsoleRatio=1-newResultRatio;if(newResultRatio>.1&&newResultRatio<.9){resultArea.style.flex=`${newResultRatio} 0 0`;consoleArea.style.flex=`${newConsoleRatio} 0 0`}}}requestAnimationFrame(update)}requestAnimationFrame(update)}function initSplitters(){document.querySelectorAll(".content-sector").forEach(sector=>{initSectorSplitter(sector)})}function toggleSidebar(){document.querySelector(".sidebar").classList.toggle("collapsed")}const btn={add:function(){const itemName=listNameInput.value.trim();const itemID="sector-"+itemCounter;const menuID="menu-"+itemCounter;if(itemName==""){alert("ë¦¬ìŠ¤íŠ¸ ì¶”ê°€ í•„ìš”");return}const existingNames=Array.from(document.querySelectorAll(".menu-sub .menu-item div")).map(div=>div.textContent.trim());if(existingNames.includes(itemName)){alert(`"${itemName}" ì´ë¦„ì€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤!`);return}const li=document.createElement("li");li.className="menu-item";const deleteBtn=document.createElement("button");deleteBtn.className="btn btn-primary btn-delete";deleteBtn.textContent="-";deleteBtn.addEventListener("click",e=>{e.stopPropagation();btn.delete(itemID)});const a=document.createElement("a");a.href="#";a.className="menu-link";a.setAttribute("data-tooltip",itemName);a.id=menuID;a.addEventListener("click",event=>{event.preventDefault();this.changeSector(itemID,a)});a.innerHTML=`\n                <span class="menu-icon">ğŸ“</span>\n                <div>${itemName}</div>\n            `;li.appendChild(deleteBtn);li.appendChild(a);menuList.appendChild(li);const sectorDiv=document.createElement("div");sectorDiv.className="content-sector";sectorDiv.id=itemID;const editorID="editor-"+itemCounter;sectorDiv.innerHTML=`\n                <div class="sector-grid-container">\n                    <div class="left-container">\n                        <div class="editor-tabs">\n                            <button class="editor-tab active" data-tab="frontend">í”„ë¡ íŠ¸ì—”ë“œ</button>\n                            <button class="editor-tab" data-tab="backend">ë°±ì—”ë“œ</button>\n                        </div>\n                        <div class="tab-content frontend-content active">\n                            <div class="template-bar">\n                                <button class="template-btn" data-template="button">ë²„íŠ¼</button>\n                                <button class="template-btn" data-template="card">ì¹´ë“œ</button>\n                                <button class="template-btn" data-template="form">í¼</button>\n                                <button class="template-btn" data-template="table">í…Œì´ë¸”</button>\n                                <button class="template-btn" data-template="flexbox">Flexbox</button>\n                                <button class="format-btn">ì½”ë“œ ì •ë ¬</button>\n                            </div>\n                            <div class="library-bar">\n                                <label class="library-checkbox">\n                                    <input type="checkbox" data-library="jquery"> jQuery\n                                </label>\n                                <label class="library-checkbox">\n                                    <input type="checkbox" data-library="bootstrap"> Bootstrap\n                                </label>\n                                <label class="library-checkbox">\n                                    <input type="checkbox" data-library="tailwind"> Tailwind\n                                </label>\n                                <label class="library-checkbox">\n                                    <input type="checkbox" data-library="vue"> Vue.js\n                                </label>\n                            </div>\n                        </div>\n                        <div class="tab-content backend-content">\n                            <div class="language-bar">\n                                <label class="language-radio">\n                                    <input type="radio" name="language-${itemCounter}" value="python" checked> Python\n                                </label>\n                                <label class="language-radio">\n                                    <input type="radio" name="language-${itemCounter}" value="java"> Java\n                                </label>\n                                <label class="language-radio">\n                                    <input type="radio" name="language-${itemCounter}" value="php"> PHP\n                                </label>\n                                <label class="language-radio">\n                                    <input type="radio" name="language-${itemCounter}" value="typescript"> Typescript\n                                </label>\n                                <button class="run-btn">â–¶ ì‹¤í–‰</button>\n                            </div>\n                        </div>\n                        <div class="memo-area">\n                            <div id="${editorID}" class="ace-editor-input"></div>\n                        </div>\n                        <div class="splitter splitter-horizontal"></div>\n                        <div class="description-area">\n                            <textarea class="description-input" placeholder="ì„¤ëª… ì…ë ¥ êµ¬ì—­"></textarea>\n                        </div>\n                    </div>\n                    <div class="splitter splitter-vertical"></div>                   \n                    <div class="right-container">\n                        <div class="result-area">\n                            <button class="fullscreen-btn" onclick="toggleFullscreen(this)">â›¶</button>\n                            <iframe class="result-iframe" sandbox="allow-scripts allow-modals"></iframe>\n                        </div>\n                        <div class="splitter splitter-console"></div>\n                        <div class="console-area">\n                            <div class="console-header">\n                                <span>ì½˜ì†”</span>\n                                <button class="console-clear-btn" onclick="clearConsole(this)">ì§€ìš°ê¸°</button>\n                            </div>\n                            <div class="console-output"></div>\n                        </div>\n                    </div>\n                </div>\n            `;mainContent.appendChild(sectorDiv);initSectorSplitter(sectorDiv);initAceEditor(sectorDiv,"");this.changeSector(itemID,a);listNameInput.value="";itemCounter++;saveStateToUrl()},delete:function(sectorId){const sector=document.getElementById(sectorId);const menuId=sectorId.replace("sector-","menu-");const menu=document.getElementById(menuId);if(!sector||!menu)return;const menuName=menu.querySelector("div").textContent;if(!confirm(`"${menuName}" ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){return}const isActive=sector.classList.contains("active");sector.remove();menu.closest(".menu-item").remove();if(isActive){const remainingSectors=document.querySelectorAll(".content-sector");if(remainingSectors.length>0){const nextSector=remainingSectors[0];const nextMenuId=nextSector.id.replace("sector-","menu-");const nextMenu=document.getElementById(nextMenuId);this.changeSector(nextSector.id,nextMenu)}}saveStateToUrl()},changeSector:function(sectorIdToShow,clickedLink){document.querySelectorAll(".menu-link").forEach(link=>{link.classList.remove("active")});document.querySelectorAll(".content-sector").forEach(sector=>{sector.classList.remove("active")});if(clickedLink){clickedLink.classList.add("active")}const sectorToShow=document.getElementById(sectorIdToShow);if(sectorToShow){sectorToShow.classList.add("active")}saveStateToUrl()}};function saveStateToUrl(){const sectors=[];document.querySelectorAll(".content-sector").forEach((sectorDiv,index)=>{const menuItem=document.querySelectorAll(".menu-sub .menu-item")[index];const menuName=menuItem.querySelector("div").textContent;const aceEditor=sectorDiv.aceEditorInstance;const memoContent=aceEditor?aceEditor.getValue():sectorDiv.querySelector(".ace-editor-input")?.textContent||"";const descContent=sectorDiv.querySelector(".description-input")?.value||"";const selectedLibraries=[];sectorDiv.querySelectorAll(".library-checkbox input:checked").forEach(checkbox=>{selectedLibraries.push(checkbox.dataset.library)});sectors.push({id:sectorDiv.id,name:menuName,memo:memoContent,description:descContent,libraries:selectedLibraries})});const activeMenu=document.querySelector(".menu-link.active");const finalActiveMenuId=activeMenu?activeMenu.id:null;const activeSector=document.querySelector(".content-sector.active");const finalSectorActiveId=activeSector?activeSector.id:null;const state={sectors:sectors,activeMenuId:finalActiveMenuId,activeSectorId:finalSectorActiveId};try{const jsonString=JSON.stringify(state);const compressedData=LZString.compressToEncodedURIComponent(jsonString);window.location.hash=compressedData}catch(e){console.error("ìƒíƒœ ì €ì¥ ì‹¤íŒ¨:",e)}}function loadStateFromUrl(){const hash=window.location.hash.substring(1);if(!hash){itemCounter=1;return}try{const jsonString=LZString.decompressFromEncodedURIComponent(hash);const state=JSON.parse(jsonString);if(!state.sectors)return;const menuList=document.querySelector(".menu-sub");const mainContent=document.querySelector(".content");menuList.innerHTML="";mainContent.innerHTML="";state.sectors.forEach(sector=>{const li=document.createElement("li");li.className="menu-item";const deleteBtn=document.createElement("button");deleteBtn.className="btn btn-primary btn-delete";deleteBtn.textContent="-";deleteBtn.addEventListener("click",e=>{e.stopPropagation();btn.delete(sector.id)});const a=document.createElement("a");a.href="#";a.className="menu-link";a.setAttribute("data-tooltip",sector.name);a.id=sector.id.replace("sector-","menu-");a.addEventListener("click",e=>{e.preventDefault();btn.changeSector(sector.id,a)});a.innerHTML=`<span class="menu-icon">ğŸ“</span><div>${sector.name}</div>`;li.appendChild(deleteBtn);li.appendChild(a);menuList.appendChild(li);const sectorDiv=document.createElement("div");sectorDiv.className="content-sector";sectorDiv.id=sector.id;const editorID=sector.id.replace("sector-","editor-");sectorDiv.innerHTML=`\n                    <div class="sector-grid-container">\n                        <div class="left-container">\n                            <div class="editor-tabs">\n                                <button class="editor-tab active" data-tab="frontend">í”„ë¡ íŠ¸ì—”ë“œ</button>\n                                <button class="editor-tab" data-tab="backend">ë°±ì—”ë“œ</button>\n                            </div>\n                            <div class="tab-content frontend-content active">\n                                <div class="template-bar">\n                                    <button class="template-btn" data-template="button">ë²„íŠ¼</button>\n                                    <button class="template-btn" data-template="card">ì¹´ë“œ</button>\n                                    <button class="template-btn" data-template="form">í¼</button>\n                                    <button class="template-btn" data-template="table">í…Œì´ë¸”</button>\n                                    <button class="template-btn" data-template="flexbox">Flexbox</button>\n                                    <button class="format-btn">ì½”ë“œ ì •ë ¬</button>\n                                </div>\n                                <div class="library-bar">\n                                    <label class="library-checkbox">\n                                        <input type="checkbox" data-library="jquery"> jQuery\n                                    </label>\n                                    <label class="library-checkbox">\n                                        <input type="checkbox" data-library="bootstrap"> Bootstrap\n                                    </label>\n                                    <label class="library-checkbox">\n                                        <input type="checkbox" data-library="tailwind"> Tailwind\n                                    </label>\n                                    <label class="library-checkbox">\n                                        <input type="checkbox" data-library="vue"> Vue.js\n                                    </label>\n                                </div>\n                            </div>\n                            <div class="tab-content backend-content">\n                                <div class="language-bar">\n                                    <label class="language-radio">\n                                        <input type="radio" name="language-${sector.id}" value="python" checked> Python\n                                    </label>\n                                    <label class="language-radio">\n                                        <input type="radio" name="language-${sector.id}" value="java"> Java\n                                    </label>\n                                    <label class="language-radio">\n                                        <input type="radio" name="language-${sector.id}" value="php"> PHP\n                                    </label>\n                                    <button class="run-btn">â–¶ ì‹¤í–‰</button>\n                                </div>\n                            </div>\n                            <div class="memo-area">\n                                <div id="${editorID}" class="ace-editor-input">${sector.memo||""}</div>\n                            </div>\n                            <div class="splitter splitter-horizontal"></div>\n                            <div class="description-area">\n                                <textarea class="description-input" placeholder="ì„¤ëª… ì…ë ¥ êµ¬ì—­">${sector.description||""}</textarea>\n                            </div>\n                        </div>\n                        <div class="splitter splitter-vertical"></div>\n                        <div class="right-container">\n                            <div class="result-area">\n                                <button class="fullscreen-btn" onclick="toggleFullscreen(this)">â›¶</button>\n                                <iframe class="result-iframe" sandbox="allow-scripts allow-modals"></iframe>\n                            </div>\n                            <div class="splitter splitter-console"></div>\n                            <div class="console-area">\n                                <div class="console-header">\n                                    <span>ì½˜ì†”</span>\n                                    <button class="console-clear-btn" onclick="clearConsole(this)">ì§€ìš°ê¸°</button>\n                                </div>\n                                <div class="console-output"></div>\n                            </div>\n                        </div>\n                    </div>\n                `;mainContent.appendChild(sectorDiv);initSectorSplitter(sectorDiv);initAceEditor(sectorDiv,sector.memo||"");if(sector.libraries&&sector.libraries.length>0){sector.libraries.forEach(lib=>{const checkbox=sectorDiv.querySelector(`.library-checkbox input[data-library="${lib}"]`);if(checkbox){checkbox.checked=true}})}});if(state.activeSectorId){const activeLink=state.activeMenuId?document.getElementById(state.activeMenuId):null;btn.changeSector(state.activeSectorId,activeLink)}if(state.sectors.length>0){const maxId=Math.max(...state.sectors.map(s=>{const num=parseInt(s.id.replace("sector-",""));return isNaN(num)?0:num}));itemCounter=maxId+1}else{itemCounter=1}}catch(e){console.error("ìƒíƒœ ë³µì› ì‹¤íŒ¨:",e)}}function renderCode(sectorElement){if(!liveMode){return}const aceEditor=sectorElement.aceEditorInstance;const resultIframe=sectorElement.querySelector(".result-iframe");const consoleOutput=sectorElement.querySelector(".console-output");if(!aceEditor||!resultIframe)return;if(consoleOutput){consoleOutput.innerHTML=""}const code=aceEditor.getValue();const selectedLibraries=[];sectorElement.querySelectorAll(".library-checkbox input:checked").forEach(checkbox=>{selectedLibraries.push(checkbox.dataset.library)});let libraryTags="";selectedLibraries.forEach(lib=>{const urls=libraryUrls[lib];if(urls){if(urls.css){urls.css.forEach(url=>{libraryTags+=`<link rel="stylesheet" href="${url}">\n`})}if(urls.js){urls.js.forEach(url=>{libraryTags+=`<script src="${url}"><\/script>\n`})}}});const consoleOverride=`\n        <script>\n            (function() {\n                const originalConsole = {\n                    log: console.log,\n                    error: console.error,\n                    warn: console.warn,\n                    info: console.info\n                };\n                \n                function sendToParent(type, args) {\n                    const message = Array.from(args).map(arg => {\n                        if (typeof arg === 'object') {\n                            try {\n                                return JSON.stringify(arg, null, 2);\n                            } catch (e) {\n                                return String(arg);\n                            }\n                        }\n                        return String(arg);\n                    }).join(' ');\n                    \n                    parent.postMessage({\n                        type: 'console',\n                        logType: type,\n                        message: message\n                    }, '*');\n                }\n                \n                console.log = function() {\n                    sendToParent('log', arguments);\n                    originalConsole.log.apply(console, arguments);\n                };\n                \n                console.error = function() {\n                    sendToParent('error', arguments);\n                    originalConsole.error.apply(console, arguments);\n                };\n                \n                console.warn = function() {\n                    sendToParent('warn', arguments);\n                    originalConsole.warn.apply(console, arguments);\n                };\n                \n                console.info = function() {\n                    sendToParent('info', arguments);\n                    originalConsole.info.apply(console, arguments);\n                };\n                \n                // ì—ëŸ¬ ìºì¹˜\n                window.onerror = function(msg, url, line, col, error) {\n                    sendToParent('error', ['Error: ' + msg + ' (line ' + line + ')']);\n                    return false;\n                };\n            })();\n        <\/script>\n    `;const content=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <meta charset="UTF-8">\n                ${consoleOverride}\n                ${libraryTags}\n                <style>\n                    /* ê¸°ë³¸ margin ì œê±° ë° iframe í¬ê¸° ì¡°ì •ì— ìœ ì—°í•˜ë„ë¡ ì„¤ì • */\n                    body { margin: 0; padding: 0; font-family: sans-serif; }\n                </style>\n            </head>\n            <body>\n                ${code}\n            </body>\n            </html>\n        `;resultIframe.srcdoc=content}function initAceEditor(sectorElement,initialCode){const editorID=sectorElement.querySelector(".ace-editor-input").id;const editor=ace.edit(editorID);editor.setOptions({enableBasicAutocompletion:true,enableSnippets:true,enableLiveAutocompletion:true});editor.setTheme("ace/theme/monokai");editor.session.setMode("ace/mode/html");editor.setValue(initialCode||"",-1);editor.session.on("change",()=>{clearTimeout(saveTimer);saveTimer=setTimeout(()=>{sectorElement.aceEditorInstance=editor;saveStateToUrl();renderCode(sectorElement)},500)});sectorElement.aceEditorInstance=editor}function clearConsole(btn){const consoleOutput=btn.closest(".console-area").querySelector(".console-output");if(consoleOutput){consoleOutput.innerHTML=""}}function downloadHTML(){const activeSector=document.querySelector(".content-sector.active");if(!activeSector){alert("ë‹¤ìš´ë¡œë“œí•  ë¦¬ìŠ¤íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");return}const aceEditor=activeSector.aceEditorInstance;if(!aceEditor)return;const code=aceEditor.getValue();const content=`<!DOCTYPE html>\n        <html lang="ko">\n        <head>\n            <meta charset="UTF-8">\n            <meta name="viewport" content="width=device-width, initial-scale=1.0">\n            <title>Document</title>\n            <style>\n                body { margin: 0; padding: 0; font-family: sans-serif; }\n            </style>\n        </head>\n        <body>\n        ${code}\n        </body>\n        </html>`;const menuId=activeSector.id.replace("sector-","menu-");const menu=document.getElementById(menuId);const fileName=menu?menu.querySelector("div").textContent.trim():"download";const blob=new Blob([content],{type:"text/html; charset=utf-8"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=`${fileName}.html`;a.click();URL.revokeObjectURL(url)}async function formatCode(btnElement){const sectorElement=btnElement.closest(".content-sector");if(!sectorElement||!sectorElement.aceEditorInstance)return;const editor=sectorElement.aceEditorInstance;const code=editor.getValue();if(!code.trim())return;btnElement.disabled=true;btnElement.textContent="ì •ë¦¬ ì¤‘...";try{const formatted=await prettier.format(code,{parser:"html",plugins:prettierPlugins,tabWidth:4,printWidth:80,htmlWhitespaceSensitivity:"ignore"});editor.setValue(formatted,-1);saveStateToUrl();renderCode(sectorElement)}catch(e){console.error("í¬ë§·íŒ… ì‹¤íŒ¨:",e);alert("ì½”ë“œ í¬ë§·íŒ…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¬¸ë²• ì˜¤ë¥˜ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.")}finally{btnElement.disabled=false;btnElement.textContent="ì½”ë“œ ì •ë ¬"}}function toggleFullscreen(btnElement){const resultArea=btnElement.closest(".result-area");if(resultArea.classList.contains("fullscreen")){resultArea.classList.remove("fullscreen");btnElement.textContent="â›¶";document.body.style.overflow=""}else{resultArea.classList.add("fullscreen");btnElement.textContent="âœ•";document.body.style.overflow="hidden"}}function openModal(){document.getElementById("introlistModal").classList.add("show")}function closeModal(){document.getElementById("introlistModal").classList.remove("show")}function updateEditorMode(editor,language){const modeMap={python:"ace/mode/python",java:"ace/mode/java",php:"ace/mode/php",typescript:"ace/mode/typescript",html:"ace/mode/html"};if(language=="html"){liveMode=true}else{liveMode=false}editor.session.setMode(modeMap[language]||"ace/mode/text")}async function executeCode(language,code){const response=await fetch("https://emkc.org/api/v2/piston/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({language:language,version:"*",files:[{content:code}]})});return await response.json()}function appendConsoleLog(consoleOutput,message,type){const logDiv=document.createElement("div");logDiv.className=`console-log ${type}`;logDiv.textContent=message;consoleOutput.appendChild(logDiv)}