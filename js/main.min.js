let itemCounter=1;const listNameInput=document.getElementById("listName"),menuList=document.querySelector(".menu-sub"),mainContent=document.querySelector(".content");let saveTimer=null;const codeTemplates={button:'<button class="btn">ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî</button>\n\n<style>\n.btn {\n    background: #1db954;\n    color: white;\n    border: none;\n    padding: 10px 20px;\n    border-radius: 5px;\n    cursor: pointer;\n    font-size: 16px;\n}\n.btn:hover {\n    background: #1ed760;\n}\n</style>',card:'<div class="card">\n    <div class="card-header">Ï†úÎ™©</div>\n    <div class="card-body">\n        <p>Ïπ¥Îìú ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.</p>\n    </div>\n</div>\n\n<style>\n.card {\n    width: 300px;\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n}\n.card-header {\n    background: #f5f5f5;\n    padding: 15px;\n    font-weight: bold;\n    border-bottom: 1px solid #ddd;\n}\n.card-body {\n    padding: 15px;\n}\n</style>',form:'<form class="form">\n    <div class="form-group">\n        <label>Ïù¥Î¶Ñ</label>\n        <input type="text" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">\n    </div>\n    <div class="form-group">\n        <label>Ïù¥Î©îÏùº</label>\n        <input type="email" placeholder="Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">\n    </div>\n    <button type="submit">Ï†úÏ∂ú</button>\n</form>\n\n<style>\n.form {\n    max-width: 300px;\n    padding: 20px;\n}\n.form-group {\n    margin-bottom: 15px;\n}\n.form-group label {\n    display: block;\n    margin-bottom: 5px;\n    font-weight: bold;\n}\n.form-group input {\n    width: 100%;\n    padding: 8px;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    box-sizing: border-box;\n}\n.form button {\n    background: #1db954;\n    color: white;\n    border: none;\n    padding: 10px 20px;\n    border-radius: 4px;\n    cursor: pointer;\n}\n</style>',table:'<table class="table">\n    <thead>\n        <tr>\n            <th>Ïù¥Î¶Ñ</th>\n            <th>ÎÇòÏù¥</th>\n            <th>ÏßÅÏóÖ</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td>ÌôçÍ∏∏Îèô</td>\n            <td>25</td>\n            <td>Í∞úÎ∞úÏûê</td>\n        </tr>\n        <tr>\n            <td>ÍπÄÏ≤†Ïàò</td>\n            <td>30</td>\n            <td>ÎîîÏûêÏù¥ÎÑà</td>\n        </tr>\n    </tbody>\n</table>\n\n<style>\n.table {\n    width: 100%;\n    border-collapse: collapse;\n}\n.table th, .table td {\n    border: 1px solid #ddd;\n    padding: 10px;\n    text-align: left;\n}\n.table th {\n    background: #f5f5f5;\n}\n.table tr:hover {\n    background: #f9f9f9;\n}\n</style>',flexbox:'<div class="flex-container">\n    <div class="flex-item">1</div>\n    <div class="flex-item">2</div>\n    <div class="flex-item">3</div>\n</div>\n\n<style>\n.flex-container {\n    display: flex;\n    gap: 10px;\n    padding: 10px;\n    background: #f0f0f0;\n}\n.flex-item {\n    flex: 1;\n    padding: 20px;\n    background: #1db954;\n    color: white;\n    text-align: center;\n    border-radius: 4px;\n}\n</style>'},libraryUrls={jquery:{js:["https://code.jquery.com/jquery-3.7.1.min.js"]},bootstrap:{css:["https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"],js:["https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"]},tailwind:{js:["https://cdn.tailwindcss.com"]},vue:{js:["https://unpkg.com/vue@3/dist/vue.global.js"]}};function initSectorSplitter(e){const t=e.querySelector(".splitter-horizontal"),n=e.querySelector(".splitter-vertical"),o=e.querySelector(".left-container"),a=e.querySelector(".memo-area"),r=e.querySelector(".description-area"),l=e.querySelector(".right-container"),s=e.querySelector(".result-iframe"),i=e.querySelector(".splitter-console"),c=e.querySelector(".result-area"),d=e.querySelector(".console-area");let u=!1,m=null,p=0,b=0,v=1,g=1,h=1,y=1,f=1,x=1,S=null,C=null;a.style.flex="2 0 0",r.style.flex="1 0 0",o.style.flex="1 0 0",l.style.flex="1 0 0",c.style.flex="4 0 0",d.style.flex="1 0 0",t.addEventListener("mousedown",e=>{u=!0,m="horizontal",t.classList.add("active"),s.classList.add("dragging"),S=e.clientX,C=e.clientY,p=e.clientY;const n=a.getBoundingClientRect().height,o=r.getBoundingClientRect().height,l=n+o;v=n/l,g=o/l,e.preventDefault()}),n.addEventListener("mousedown",e=>{u=!0,m="vertical",n.classList.add("active"),s.classList.add("dragging"),S=e.clientX,C=e.clientY,b=e.clientX;const t=o.getBoundingClientRect().width,a=l.getBoundingClientRect().width,r=t+a;y=t/r,f=a/r,e.preventDefault()}),i.addEventListener("mousedown",e=>{u=!0,m="horizontalConsole",i.classList.add("active"),s.classList.add("dragging"),S=e.clientX,C=e.clientY,p=e.clientY;const t=c.getBoundingClientRect().height,n=d.getBoundingClientRect().height,o=t+n;h=t/o,x=n/o,e.preventDefault()}),document.addEventListener("mousemove",e=>{u&&(S=e.clientX,C=e.clientY)}),document.addEventListener("mouseup",()=>{u&&(u=!1,t.classList.remove("active"),n.classList.remove("active"),i.classList.remove("active"),s.classList.remove("dragging"),m=null)}),requestAnimationFrame(function t(){if(u&&(null!==S||null!==C))if("horizontal"===m){const e=o.getBoundingClientRect().height-4,t=(e*v+(C-p))/e,n=1-t;t>.1&&t<.9&&(a.style.flex=`${t} 0 0`,r.style.flex=`${n} 0 0`)}else if("vertical"===m){const t=e.querySelector(".sector-grid-container").getBoundingClientRect().width-4,n=(t*y+(S-b))/t,a=1-n;n>.2&&n<.8&&(o.style.flex=`${n} 0 0`,l.style.flex=`${a} 0 0`)}else if("horizontalConsole"===m){const e=l.getBoundingClientRect().height-4,t=(e*h+(C-p))/e,n=1-t;t>.1&&t<.9&&(c.style.flex=`${t} 0 0`,d.style.flex=`${n} 0 0`)}requestAnimationFrame(t)})}function initSplitters(){document.querySelectorAll(".content-sector").forEach(e=>{initSectorSplitter(e)})}function toggleSidebar(){document.querySelector(".sidebar").classList.toggle("collapsed")}document.addEventListener("DOMContentLoaded",()=>{loadStateFromUrl(),window.addEventListener("message",e=>{if(e.data&&"console"===e.data.type){const t=document.querySelector(".content-sector.active");if(t){const n=t.querySelector(".console-output");if(n){const t=document.createElement("div");t.className=`console-log ${e.data.logType}`,t.textContent=e.data.message,n.appendChild(t),n.scrollTop=n.scrollHeight}}}}),mainContent.addEventListener("click",e=>{if(e.target.classList.contains("template-btn")){const t=e.target.dataset.template,n=codeTemplates[t];if(n){const t=e.target.closest(".content-sector");if(t&&t.aceEditorInstance){const e=t.aceEditorInstance;e.insert(n),e.focus(),saveStateToUrl(),renderCode(t)}}}}),mainContent.addEventListener("change",e=>{if(e.target.matches('.library-checkbox input[type="checkbox"]')){const t=e.target.closest(".content-sector");t&&(saveStateToUrl(),renderCode(t))}}),mainContent.addEventListener("input",e=>{if("TEXTAREA"===e.target.tagName){const t=e.target.closest(".content-sector");clearTimeout(saveTimer),saveTimer=setTimeout(()=>{saveStateToUrl(),renderCode(t)},500)}}),initSplitters(),document.querySelectorAll(".content-sector").forEach(renderCode)});const btn={add:function(){const e=listNameInput.value.trim(),t="sector-"+itemCounter,n="menu-"+itemCounter;if(""==e)return void alert("Î¶¨Ïä§Ìä∏ Ï∂îÍ∞Ä ÌïÑÏöî");if(Array.from(document.querySelectorAll(".menu-sub .menu-item div")).map(e=>e.textContent.trim()).includes(e))return void alert(`"${e}" Ïù¥Î¶ÑÏùÄ Ïù¥ÎØ∏ Ï°¥Ïû¨Ìï©ÎãàÎã§!`);const o=document.createElement("li");o.className="menu-item";const a=document.createElement("button");a.className="btn btn-primary btn-delete",a.textContent="-",a.addEventListener("click",e=>{e.stopPropagation(),btn.delete(t)});const r=document.createElement("a");r.href="#",r.className="menu-link",r.setAttribute("data-tooltip",e),r.id=n,r.addEventListener("click",e=>{e.preventDefault(),this.changeSector(t,r)}),r.innerHTML=`\n                <span class="menu-icon">üìù</span>\n                <div>${e}</div>\n            `,o.appendChild(a),o.appendChild(r),menuList.appendChild(o);const l=document.createElement("div");l.className="content-sector",l.id=t;const s="editor-"+itemCounter;l.innerHTML=`\n                <div class="sector-grid-container">\n                    <div class="left-container">\n                        <div class="template-bar">\n                            <button class="template-btn" data-template="button">Î≤ÑÌäº</button>\n                            <button class="template-btn" data-template="card">Ïπ¥Îìú</button>\n                            <button class="template-btn" data-template="form">Ìèº</button>\n                            <button class="template-btn" data-template="table">ÌÖåÏù¥Î∏î</button>\n                            <button class="template-btn" data-template="flexbox">Flexbox</button>\n                        </div>\n                        <div class="library-bar">\n                            <label class="library-checkbox">\n                                <input type="checkbox" data-library="jquery"> jQuery\n                            </label>\n                            <label class="library-checkbox">\n                                <input type="checkbox" data-library="bootstrap"> Bootstrap\n                            </label>\n                            <label class="library-checkbox">\n                                <input type="checkbox" data-library="tailwind"> Tailwind\n                            </label>\n                            <label class="library-checkbox">\n                                <input type="checkbox" data-library="vue"> Vue.js\n                            </label>\n                        </div>\n                        <div class="memo-area">\n                            <div id="${s}" class="ace-editor-input"></div>\n                        </div>\n                        <div class="splitter splitter-horizontal"></div>\n                        <div class="description-area">\n                            <textarea class="description-input" placeholder="ÏÑ§Î™Ö ÏûÖÎ†• Íµ¨Ïó≠"></textarea>\n                        </div>\n                    </div>\n                    <div class="splitter splitter-vertical"></div>                   \n                    <div class="right-container">\n                        <div class="result-area">\n                            <iframe class="result-iframe" sandbox="allow-scripts allow-modals"></iframe>\n                        </div>\n                        <div class="splitter splitter-console"></div>\n                        <div class="console-area">\n                            <div class="console-header">\n                                <span>ÏΩòÏÜî</span>\n                                <button class="console-clear-btn" onclick="clearConsole(this)">ÏßÄÏö∞Í∏∞</button>\n                            </div>\n                            <div class="console-output"></div>\n                        </div>\n                    </div>\n                </div>\n            `,mainContent.appendChild(l),initSectorSplitter(l),initAceEditor(l,""),this.changeSector(t,r),listNameInput.value="",itemCounter++,saveStateToUrl()},delete:function(e){const t=document.getElementById(e),n=e.replace("sector-","menu-"),o=document.getElementById(n);if(!t||!o)return;const a=o.querySelector("div").textContent;if(!confirm(`"${a}" Î¶¨Ïä§Ìä∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`))return;const r=t.classList.contains("active");if(t.remove(),o.closest(".menu-item").remove(),r){const e=document.querySelectorAll(".content-sector");if(e.length>0){const t=e[0],n=t.id.replace("sector-","menu-"),o=document.getElementById(n);this.changeSector(t.id,o)}}saveStateToUrl()},changeSector:function(e,t){document.querySelectorAll(".menu-link").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".content-sector").forEach(e=>{e.classList.remove("active")}),t&&t.classList.add("active");const n=document.getElementById(e);n&&n.classList.add("active"),saveStateToUrl()}};function saveStateToUrl(){const e=[];document.querySelectorAll(".content-sector").forEach((t,n)=>{const o=document.querySelectorAll(".menu-sub .menu-item")[n].querySelector("div").textContent,a=t.aceEditorInstance,r=a?a.getValue():t.querySelector(".ace-editor-input")?.textContent||"",l=t.querySelector(".description-input")?.value||"",s=[];t.querySelectorAll(".library-checkbox input:checked").forEach(e=>{s.push(e.dataset.library)}),e.push({id:t.id,name:o,memo:r,description:l,libraries:s})});const t=document.querySelector(".menu-link.active"),n=t?t.id:null,o=document.querySelector(".content-sector.active"),a=o?o.id:null,r={sectors:e,activeMenuId:n,activeSectorId:a};try{const e=JSON.stringify(r),t=LZString.compressToEncodedURIComponent(e);window.location.hash=t}catch(e){console.error("ÏÉÅÌÉú Ï†ÄÏû• Ïã§Ìå®:",e)}}function loadStateFromUrl(){const e=window.location.hash.substring(1);if(e)try{const t=LZString.decompressFromEncodedURIComponent(e),n=JSON.parse(t);if(!n.sectors)return;const o=document.querySelector(".menu-sub"),a=document.querySelector(".content");if(o.innerHTML="",a.innerHTML="",n.sectors.forEach(e=>{const t=document.createElement("li");t.className="menu-item";const n=document.createElement("button");n.className="btn btn-primary btn-delete",n.textContent="-",n.addEventListener("click",t=>{t.stopPropagation(),btn.delete(e.id)});const r=document.createElement("a");r.href="#",r.className="menu-link",r.setAttribute("data-tooltip",e.name),r.id=e.id.replace("sector-","menu-"),r.addEventListener("click",t=>{t.preventDefault(),btn.changeSector(e.id,r)}),r.innerHTML=`<span class="menu-icon">üìù</span><div>${e.name}</div>`,t.appendChild(n),t.appendChild(r),o.appendChild(t);const l=document.createElement("div");l.className="content-sector",l.id=e.id;const s=e.id.replace("sector-","editor-");l.innerHTML=`\n                    <div class="sector-grid-container">\n                        <div class="left-container">\n                            <div class="template-bar">\n                                <button class="template-btn" data-template="button">Î≤ÑÌäº</button>\n                                <button class="template-btn" data-template="card">Ïπ¥Îìú</button>\n                                <button class="template-btn" data-template="form">Ìèº</button>\n                                <button class="template-btn" data-template="table">ÌÖåÏù¥Î∏î</button>\n                                <button class="template-btn" data-template="flexbox">Flexbox</button>\n                            </div>\n                            <div class="library-bar">\n                                <label class="library-checkbox">\n                                    <input type="checkbox" data-library="jquery"> jQuery\n                                </label>\n                                <label class="library-checkbox">\n                                    <input type="checkbox" data-library="bootstrap"> Bootstrap\n                                </label>\n                                <label class="library-checkbox">\n                                    <input type="checkbox" data-library="tailwind"> Tailwind\n                                </label>\n                                <label class="library-checkbox">\n                                    <input type="checkbox" data-library="vue"> Vue.js\n                                </label>\n                            </div>\n                            <div class="memo-area">\n                                <div id="${s}" class="ace-editor-input">${e.memo||""}</div>\n                            </div>\n                            <div class="splitter splitter-horizontal"></div>\n                            <div class="description-area">\n                                <textarea class="description-input" placeholder="ÏÑ§Î™Ö ÏûÖÎ†• Íµ¨Ïó≠">${e.description||""}</textarea>\n                            </div>\n                        </div>\n                        <div class="splitter splitter-vertical"></div>\n                        <div class="right-container">\n                            <div class="result-area">\n                                <iframe class="result-iframe" sandbox="allow-scripts allow-modals"></iframe>\n                            </div>\n                            <div class="splitter splitter-console"></div>\n                            <div class="console-area">\n                                <div class="console-header">\n                                    <span>ÏΩòÏÜî</span>\n                                    <button class="console-clear-btn" onclick="clearConsole(this)">ÏßÄÏö∞Í∏∞</button>\n                                </div>\n                                <div class="console-output"></div>\n                            </div>\n                        </div>\n                    </div>\n                `,a.appendChild(l),initSectorSplitter(l),initAceEditor(l,e.memo||""),e.libraries&&e.libraries.length>0&&e.libraries.forEach(e=>{const t=l.querySelector(`.library-checkbox input[data-library="${e}"]`);t&&(t.checked=!0)})}),n.activeSectorId){const e=n.activeMenuId?document.getElementById(n.activeMenuId):null;btn.changeSector(n.activeSectorId,e)}if(n.sectors.length>0){const e=Math.max(...n.sectors.map(e=>{const t=parseInt(e.id.replace("sector-",""));return isNaN(t)?0:t}));itemCounter=e+1}else itemCounter=1}catch(e){console.error("ÏÉÅÌÉú Î≥µÏõê Ïã§Ìå®:",e)}else itemCounter=1}function renderCode(e){const t=e.aceEditorInstance,n=e.querySelector(".result-iframe"),o=e.querySelector(".console-output");if(!t||!n)return;o&&(o.innerHTML="");const a=t.getValue(),r=[];e.querySelectorAll(".library-checkbox input:checked").forEach(e=>{r.push(e.dataset.library)});let l="";r.forEach(e=>{const t=libraryUrls[e];t&&(t.css&&t.css.forEach(e=>{l+=`<link rel="stylesheet" href="${e}">\n`}),t.js&&t.js.forEach(e=>{l+=`<script src="${e}"><\/script>\n`}))});const s=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <meta charset="UTF-8">\n                \n        <script>\n            (function() {\n                const originalConsole = {\n                    log: console.log,\n                    error: console.error,\n                    warn: console.warn,\n                    info: console.info\n                };\n                \n                function sendToParent(type, args) {\n                    const message = Array.from(args).map(arg => {\n                        if (typeof arg === 'object') {\n                            try {\n                                return JSON.stringify(arg, null, 2);\n                            } catch (e) {\n                                return String(arg);\n                            }\n                        }\n                        return String(arg);\n                    }).join(' ');\n                    \n                    parent.postMessage({\n                        type: 'console',\n                        logType: type,\n                        message: message\n                    }, '*');\n                }\n                \n                console.log = function() {\n                    sendToParent('log', arguments);\n                    originalConsole.log.apply(console, arguments);\n                };\n                \n                console.error = function() {\n                    sendToParent('error', arguments);\n                    originalConsole.error.apply(console, arguments);\n                };\n                \n                console.warn = function() {\n                    sendToParent('warn', arguments);\n                    originalConsole.warn.apply(console, arguments);\n                };\n                \n                console.info = function() {\n                    sendToParent('info', arguments);\n                    originalConsole.info.apply(console, arguments);\n                };\n                \n                // ÏóêÎü¨ Ï∫êÏπò\n                window.onerror = function(msg, url, line, col, error) {\n                    sendToParent('error', ['Error: ' + msg + ' (line ' + line + ')']);\n                    return false;\n                };\n            })();\n        <\/script>\n    \n                ${l}\n                <style>\n                    /* Í∏∞Î≥∏ margin Ï†úÍ±∞ Î∞è iframe ÌÅ¨Í∏∞ Ï°∞Ï†ïÏóê Ïú†Ïó∞ÌïòÎèÑÎ°ù ÏÑ§Ï†ï */\n                    body { margin: 0; padding: 0; font-family: sans-serif; }\n                </style>\n            </head>\n            <body>\n                ${a}\n            </body>\n            </html>\n        `;n.srcdoc=s}function initAceEditor(e,t){const n=e.querySelector(".ace-editor-input").id,o=ace.edit(n);o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),o.setTheme("ace/theme/monokai"),o.session.setMode("ace/mode/html"),o.setValue(t||"",-1),o.session.on("change",()=>{clearTimeout(saveTimer),saveTimer=setTimeout(()=>{e.aceEditorInstance=o,saveStateToUrl(),renderCode(e)},500)}),e.aceEditorInstance=o}function clearConsole(e){const t=e.closest(".console-area").querySelector(".console-output");t&&(t.innerHTML="")}function downloadHTML(){const e=document.querySelector(".content-sector.active");if(!e)return void alert("Îã§Ïö¥Î°úÎìúÌï† Î¶¨Ïä§Ìä∏Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");const t=e.aceEditorInstance;if(!t)return;const n=`<!DOCTYPE html>\n        <html lang="ko">\n        <head>\n            <meta charset="UTF-8">\n            <meta name="viewport" content="width=device-width, initial-scale=1.0">\n            <title>Document</title>\n            <style>\n                body { margin: 0; padding: 0; font-family: sans-serif; }\n            </style>\n        </head>\n        <body>\n        ${t.getValue()}\n        </body>\n        </html>`,o=e.id.replace("sector-","menu-"),a=document.getElementById(o),r=a?a.querySelector("div").textContent.trim():"download",l=new Blob([n],{type:"text/html; charset=utf-8"}),s=URL.createObjectURL(l),i=document.createElement("a");i.href=s,i.download=`${r}.html`,i.click(),URL.revokeObjectURL(s)}