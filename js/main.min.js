let itemCounter=1;const listNameInput=document.getElementById("listName"),menuList=document.querySelector(".menu-sub"),mainContent=document.querySelector(".content");let saveTimer=null;function initSectorSplitter(e){const t=e.querySelector(".splitter-horizontal"),n=e.querySelector(".splitter-vertical"),i=e.querySelector(".left-container"),o=e.querySelector(".memo-area"),c=e.querySelector(".description-area"),r=e.querySelector(".right-container"),s=e.querySelector(".result-iframe");let a=!1,l=null,d=0,u=0,m=1,v=1,p=1,f=1,h=null,g=null;o.style.flex="1 0 0",c.style.flex="1 0 0",i.style.flex="1 0 0",r.style.flex="1 0 0",t.addEventListener("mousedown",e=>{a=!0,l="horizontal",t.classList.add("active"),s.classList.add("dragging"),d=e.clientY;const n=o.getBoundingClientRect().height,i=c.getBoundingClientRect().height,r=n+i;m=n/r,v=i/r,e.preventDefault()}),n.addEventListener("mousedown",e=>{a=!0,l="vertical",n.classList.add("active"),s.classList.add("dragging"),u=e.clientX;const t=i.getBoundingClientRect().width,o=r.getBoundingClientRect().width,c=t+o;p=t/c,f=o/c,e.preventDefault()}),document.addEventListener("mousemove",e=>{a&&(h=e.clientX,g=e.clientY)}),document.addEventListener("mouseup",()=>{a&&(a=!1,t.classList.remove("active"),n.classList.remove("active"),s.classList.remove("dragging"),l=null)}),requestAnimationFrame(function t(){if(a&&(null!==h||null!==g))if("horizontal"===l){const e=i.getBoundingClientRect().height-4,t=(e*m+(g-d))/e,n=1-t;t>.1&&t<.9&&(o.style.flex=`${t} 0 0`,c.style.flex=`${n} 0 0`)}else if("vertical"===l){const t=e.querySelector(".sector-grid-container").getBoundingClientRect().width-4,n=(t*p+(h-u))/t,o=1-n;n>.2&&n<.8&&(i.style.flex=`${n} 0 0`,r.style.flex=`${o} 0 0`)}requestAnimationFrame(t)})}function initSplitters(){document.querySelectorAll(".content-sector").forEach(e=>{initSectorSplitter(e)})}function toggleSidebar(){document.querySelector(".sidebar").classList.toggle("collapsed")}document.addEventListener("DOMContentLoaded",()=>{loadStateFromUrl(),mainContent.addEventListener("input",e=>{if("TEXTAREA"===e.target.tagName){const t=e.target.closest(".content-sector");clearTimeout(saveTimer),saveTimer=setTimeout(()=>{saveStateToUrl(),renderCode(t)},500)}}),initSplitters(),document.querySelectorAll(".content-sector").forEach(renderCode)});const btn={add:function(){const e=listNameInput.value.trim(),t="sector-"+itemCounter,n="menu-"+itemCounter;if(""==e)return void alert("ë¦¬ìŠ¤íŠ¸ ì¶”ê°€ í•„ìš”");if(Array.from(document.querySelectorAll(".menu-sub .menu-item div")).map(e=>e.textContent.trim()).includes(e))return void alert(`"${e}" ì´ë¦„ì€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤!`);const i=document.createElement("li");i.className="menu-item";const o=document.createElement("button");o.className="btn btn-primary btn-delete",o.textContent="-",o.addEventListener("click",e=>{e.stopPropagation(),btn.delete(t)});const c=document.createElement("a");c.href="#",c.className="menu-link",c.setAttribute("data-tooltip",e),c.id=n,c.addEventListener("click",e=>{e.preventDefault(),this.changeSector(t,c)}),c.innerHTML=`\n                <span class="menu-icon">ğŸ“</span>\n                <div>${e}</div>\n            `,i.appendChild(o),i.appendChild(c),menuList.appendChild(i);const r=document.createElement("div");r.className="content-sector",r.id=t;const s="editor-"+itemCounter;r.innerHTML=`\n                <div class="sector-grid-container">\n                    <div class="left-container">\n                        <div class="memo-area">\n                            <div id="${s}" class="ace-editor-input"></div>\n                        </div>\n                        <div class="splitter splitter-horizontal"></div>\n                        <div class="description-area">\n                            <textarea class="description-input" placeholder="ì„¤ëª… ì…ë ¥ êµ¬ì—­"></textarea>\n                        </div>\n                    </div>\n                    <div class="splitter splitter-vertical"></div>\n                    <div class="right-container">\n                        <div class="result-area">\n                            <iframe class="result-iframe" sandbox="allow-scripts allow-modals"></iframe>\n                        </div>\n                    </div>\n                </div>\n            `,mainContent.appendChild(r),initSectorSplitter(r),initAceEditor(r,""),this.changeSector(t,c),listNameInput.value="",itemCounter++,saveStateToUrl()},delete:function(e){const t=document.getElementById(e),n=e.replace("sector-","menu-"),i=document.getElementById(n);if(!t||!i)return;const o=i.querySelector("div").textContent;if(!confirm(`"${o}" ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return;const c=t.classList.contains("active");if(t.remove(),i.closest(".menu-item").remove(),c){const e=document.querySelectorAll(".content-sector");if(e.length>0){const t=e[0],n=t.id.replace("sector-","menu-"),i=document.getElementById(n);this.changeSector(t.id,i)}}saveStateToUrl()},changeSector:function(e,t){document.querySelectorAll(".menu-link").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".content-sector").forEach(e=>{e.classList.remove("active")}),t&&t.classList.add("active");const n=document.getElementById(e);n&&n.classList.add("active"),saveStateToUrl()}};function saveStateToUrl(){const e=[];document.querySelectorAll(".content-sector").forEach((t,n)=>{const i=document.querySelectorAll(".menu-sub .menu-item")[n].querySelector("div").textContent,o=t.aceEditorInstance,c=o?o.getValue():t.querySelector(".ace-editor-input")?.textContent||"",r=t.querySelector(".description-input")?.value||"";e.push({id:t.id,name:i,memo:c,description:r})});const t=document.querySelector(".menu-link.active"),n=t?t.id:null,i=document.querySelector(".content-sector.active"),o=i?i.id:null,c={sectors:e,activeMenuId:n,activeSectorId:o};try{const e=JSON.stringify(c),t=encodeURIComponent(e),n=btoa(t);window.location.hash=n}catch(e){console.error("ìƒíƒœ ì €ì¥ ì‹¤íŒ¨:",e)}}function loadStateFromUrl(){const e=window.location.hash.substring(1);if(e)try{const t=atob(e),n=JSON.parse(decodeURIComponent(t));if(!n.sectors)return;const i=document.querySelector(".menu-sub"),o=document.querySelector(".content");if(i.innerHTML="",o.innerHTML="",n.sectors.forEach(e=>{const t=document.createElement("li");t.className="menu-item";const n=document.createElement("button");n.className="btn btn-primary btn-delete",n.textContent="-",n.addEventListener("click",t=>{t.stopPropagation(),btn.delete(e.id)});const c=document.createElement("a");c.href="#",c.className="menu-link",c.setAttribute("data-tooltip",e.name),c.id=e.id.replace("sector-","menu-"),c.addEventListener("click",t=>{t.preventDefault(),btn.changeSector(e.id,c)}),c.innerHTML=`<span class="menu-icon">ğŸ“</span><div>${e.name}</div>`,t.appendChild(n),t.appendChild(c),i.appendChild(t);const r=document.createElement("div");r.className="content-sector",r.id=e.id;const s=e.id.replace("sector-","editor-");r.innerHTML=`\n                    <div class="sector-grid-container">\n                        <div class="left-container">\n                            <div class="memo-area">\n                                <div id="${s}" class="ace-editor-input">${e.memo||""}</div>\n                            </div>\n                            <div class="splitter splitter-horizontal"></div>\n                            <div class="description-area">\n                                <textarea class="description-input" placeholder="ì„¤ëª… ì…ë ¥ êµ¬ì—­">${e.description||""}</textarea>\n                            </div>\n                        </div>\n                        <div class="splitter splitter-vertical"></div>\n                        <div class="right-container">\n                            <div class="result-area">\n                                <iframe class="result-iframe" sandbox="allow-scripts allow-modals"></iframe>\n                            </div>\n                        </div>\n                    </div>\n                `,o.appendChild(r),initSectorSplitter(r),initAceEditor(r,e.memo||"")}),n.activeSectorId){const e=n.activeMenuId?document.getElementById(n.activeMenuId):null;btn.changeSector(n.activeSectorId,e)}if(n.sectors.length>0){const e=Math.max(...n.sectors.map(e=>{const t=parseInt(e.id.replace("sector-",""));return isNaN(t)?0:t}));itemCounter=e+1}else itemCounter=1}catch(e){console.error("ìƒíƒœ ë³µì› ì‹¤íŒ¨:",e)}else itemCounter=1}function renderCode(e){const t=e.aceEditorInstance,n=e.querySelector(".result-iframe");if(!t||!n)return;const i=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <style>\n                    /* ê¸°ë³¸ margin ì œê±° ë° iframe í¬ê¸° ì¡°ì •ì— ìœ ì—°í•˜ë„ë¡ ì„¤ì • */\n                    body { margin: 0; padding: 0; font-family: sans-serif; }\n                </style>\n            </head>\n            <body>\n                ${t.getValue()}\n            </body>\n            </html>\n        `;n.srcdoc=i}function initAceEditor(e,t){const n=e.querySelector(".ace-editor-input").id,i=ace.edit(n);i.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),i.setTheme("ace/theme/monokai"),i.session.setMode("ace/mode/html"),i.setValue(t||"",-1),i.session.on("change",()=>{clearTimeout(saveTimer),saveTimer=setTimeout(()=>{e.aceEditorInstance=i,saveStateToUrl(),renderCode(e)},500)}),e.aceEditorInstance=i}